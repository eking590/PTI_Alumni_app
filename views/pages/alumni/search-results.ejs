<%- include('../../partials/header') %>

<div class="container mx-auto px-4 py-8 max-w-6xl">
  <h2 class="text-2xl font-bold mb-6">Search Results</h2>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
    <!-- Local Database Results -->
    <div class="bg-white p-6 rounded-lg shadow">
      <h3 class="text-xl font-semibold mb-4 border-b pb-2">Database Matches</h3>
      
      <% if (localResults && localResults.length > 0) { %>
        <ul class="space-y-3">
          <% localResults.forEach(alum => { %>
            <li class="hover:bg-gray-50 p-2 rounded transition-colors">
              <div class="flex items-center justify-between">
                <span class="font-medium">
                  <%= alum.firstName %> <%= alum.lastName %>
                  <% if (alum.graduationYear) { %>
                    <span class="text-gray-500">(<%= alum.graduationYear %>)</span>
                  <% } %>
                </span>
              </div>
              <% if (alum.currentCompany || alum.currentPosition) { %>
                <div class="text-sm text-gray-600 mt-1">
                  <% if (alum.currentPosition) { %><%= alum.currentPosition %><% } %>
                  <% if (alum.currentCompany) { %> at <%= alum.currentCompany %><% } %>
                </div>
              <% } %>
            </li>
          <% }); %>
        </ul>
      <% } else { %>
        <p class="text-gray-500">No alumni found in our database.</p>
      <% } %>
    </div>

    <!-- Mistral API Results -->
    <div class="bg-white p-6 rounded-lg shadow">
      <h3 class="text-xl font-semibold mb-4 border-b pb-2">AI Suggestions</h3>
      
      <% 
        let mistralContent = '';
        if (apiResults && apiResults.choices && apiResults.choices.length > 0) {
          mistralContent = apiResults.choices[0].message.content;
          
          // Convert markdown-like formatting to HTML
          mistralContent = mistralContent
            .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>') // bold
            .replace(/\*(.*?)\*/g, '<em>$1</em>') // italic
            .replace(/\n\n/g, '</p><p>') // paragraphs
            .replace(/\n/g, '<br>'); // line breaks
        }
      %>
      
      <% if (mistralContent) { %>
        <div class="api-results prose max-w-none">
          <p><%- mistralContent %></p>
        </div>
      <% } else { %>
        <p class="text-gray-500">No suggestions available from the AI.</p>
      <% } %>

      <div class="mt-4 p-3 bg-blue-50 rounded text-sm text-blue-800">
        These suggestions are generated by AI based on your search criteria.
      </div>
    </div>
  </div>
</div>

<%- include('../../partials/footer') %>